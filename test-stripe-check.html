<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stripe Configuration Checker</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        button {
            background: #4f7cff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #3a5fd9;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #output {
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
        }
        .status-box {
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            font-weight: bold;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .check-item {
            padding: 10px;
            margin: 8px 0;
            border-left: 4px solid #ddd;
            background: #f8f9fa;
        }
        .check-item.pass {
            border-left-color: #28a745;
        }
        .check-item.fail {
            border-left-color: #dc3545;
        }
        .icon {
            font-size: 20px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Stripe Configuration Checker</h1>
        <p class="subtitle">Verify your Stripe keys are properly configured in Supabase</p>
        
        <div>
            <button onclick="checkConfig()">üîç Check Configuration</button>
            <button onclick="clearOutput()">üóëÔ∏è Clear Output</button>
        </div>

        <div id="output">Click "Check Configuration" to verify your Stripe setup...</div>
    </div>

    <script>
        const SUPABASE_URL = 'https://wcuxqopfcgivypbiynjp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndjdXhxb3BmY2dpdnlwYml5bmpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzNDI1NzMsImV4cCI6MjA3MTkxODU3M30.-RkbzPY_FZVd9qShJxi959LLSqWXYI7Mkqk1DqJVt6o';

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        function createStatusBox(ok, title, message) {
            const className = ok ? 'status-success' : 'status-error';
            const icon = ok ? '‚úÖ' : '‚ùå';
            return `
                <div class="${className} status-box">
                    <div>${icon} <strong>${title}</strong></div>
                    <div style="margin-top: 5px; font-weight: normal;">${message}</div>
                </div>
            `;
        }

        function createCheckItem(pass, label, value) {
            const className = pass ? 'pass' : 'fail';
            const icon = pass ? '‚úÖ' : '‚ùå';
            return `
                <div class="check-item ${className}">
                    <span class="icon">${icon}</span>
                    <strong>${label}:</strong> ${value}
                </div>
            `;
        }

        async function checkConfig() {
            const output = document.getElementById('output');
            output.innerHTML = '<div style="text-align: center;">üîÑ Checking configuration...</div>';

            try {
                const response = await fetch(`${SUPABASE_URL}/functions/v1/check-stripe`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                let html = '';
                
                // Overall status
                if (data.ok) {
                    html += createStatusBox(true, 'Configuration Complete', 
                        'All Stripe keys are properly configured! You\'re ready to accept payments.');
                } else {
                    html += createStatusBox(false, 'Configuration Incomplete', 
                        'Some Stripe keys are missing. See details below.');
                }

                // Individual checks
                html += '<div style="margin-top: 20px;"><strong>Configuration Details:</strong></div>';
                
                if (data.details) {
                    html += createCheckItem(
                        data.details.hasPublishableKey, 
                        'Publishable Key (STRIPE_PUBLISHABLE_KEY)',
                        data.details.hasPublishableKey ? 'Configured' : 'Missing'
                    );
                    
                    html += createCheckItem(
                        data.details.hasSecretKey,
                        'Secret Key (STRIPE_SECRET_KEY)',
                        data.details.hasSecretKey ? 'Configured' : 'Missing'
                    );
                    
                    html += createCheckItem(
                        data.details.hasAuthHeader,
                        'Authorization Header',
                        data.details.hasAuthHeader ? 'Present' : 'Missing'
                    );
                }

                // Issues list
                if (data.issues && data.issues.length > 0) {
                    html += '<div style="margin-top: 20px;"><strong>‚ùå Issues Found:</strong></div>';
                    data.issues.forEach(issue => {
                        html += `<div style="color: #dc3545; padding: 8px; margin: 5px 0; background: #f8d7da; border-radius: 4px;">‚Ä¢ ${issue}</div>`;
                    });

                    // Solutions
                    html += '<div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 6px; border-left: 4px solid #0066cc;">';
                    html += '<strong>üí° How to Fix:</strong><br><br>';
                    
                    if (!data.details?.hasPublishableKey) {
                        html += `
                            <div style="margin-bottom: 15px;">
                                <strong>1. Add STRIPE_PUBLISHABLE_KEY:</strong><br>
                                ‚Ä¢ Go to: <a href="https://supabase.com/dashboard/project/wcuxqopfcgivypbiynjp/settings/secrets" target="_blank">Supabase Secrets</a><br>
                                ‚Ä¢ Add: STRIPE_PUBLISHABLE_KEY = pk_live_YOUR_KEY<br>
                                ‚Ä¢ Get key from: <a href="https://dashboard.stripe.com/apikeys" target="_blank">Stripe Dashboard</a>
                            </div>
                        `;
                    }
                    
                    if (!data.details?.hasSecretKey) {
                        html += `
                            <div style="margin-bottom: 15px;">
                                <strong>2. Add STRIPE_SECRET_KEY:</strong><br>
                                ‚Ä¢ Go to: <a href="https://supabase.com/dashboard/project/wcuxqopfcgivypbiynjp/settings/secrets" target="_blank">Supabase Secrets</a><br>
                                ‚Ä¢ Add: STRIPE_SECRET_KEY = sk_live_YOUR_KEY<br>
                                ‚Ä¢ Get key from: <a href="https://dashboard.stripe.com/apikeys" target="_blank">Stripe Dashboard</a>
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                }

                // Next steps
                if (data.ok) {
                    html += `
                        <div style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 6px; border-left: 4px solid #28a745;">
                            <strong>üéâ Next Steps:</strong><br><br>
                            1. ‚úÖ Verify products in <a href="https://dashboard.stripe.com/products" target="_blank">Stripe Dashboard</a><br>
                            2. üîî Configure webhook endpoint (see NEXT_STEPS.md)<br>
                            3. üß™ Test subscription flow in your app<br>
                            4. üöÄ Start accepting payments!
                        </div>
                    `;
                }

                // Raw response (collapsible)
                html += `
                    <details style="margin-top: 20px;">
                        <summary style="cursor: pointer; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                            <strong>üîç View Raw Response</strong>
                        </summary>
                        <pre style="margin-top: 10px; padding: 15px; background: #272822; color: #f8f8f2; border-radius: 4px; overflow-x: auto;">${JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;

                output.innerHTML = html;

            } catch (error) {
                output.innerHTML = `
                    ${createStatusBox(false, 'Network Error', error.message)}
                    <div style="margin-top: 15px;">
                        <strong>Possible causes:</strong><br>
                        ‚Ä¢ Edge function not deployed<br>
                        ‚Ä¢ Network connectivity issue<br>
                        ‚Ä¢ CORS configuration problem
                    </div>
                `;
            }
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            setTimeout(checkConfig, 500);
        });
    </script>
</body>
</html>
